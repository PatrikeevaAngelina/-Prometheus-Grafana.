# üöÄ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å Prometheus –∏ Grafana

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø–æ–ª–Ω—ã–π —Å—Ç–µ–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–ª—è —Å–±–æ—Ä–∞, —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫ –≤–∞—à–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

- **Prometheus** - —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å–±–æ—Ä–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ –¥–∞–Ω–Ω—ã—Ö (–ø–æ—Ä—Ç 9090)
- **Grafana** - –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫ –∏ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞—à–±–æ—Ä–¥–æ–≤ (–ø–æ—Ä—Ç 3000)
- **Node Exporter** - –∞–≥–µ–Ω—Ç –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã (–ø–æ—Ä—Ç 9100)
- **cAdvisor** - —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ Docker (–ø–æ—Ä—Ç 8080)
- **Alertmanager** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–ø–æ—Ä—Ç 9093)

### –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã

1. **–°–±–æ—Ä –º–µ—Ç—Ä–∏–∫**: Exporters (node_exporter, cadvisor) —Å–æ–±–∏—Ä–∞—é—Ç –º–µ—Ç—Ä–∏–∫–∏ —Å —Å–∏—Å—Ç–µ–º –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
2. **–•—Ä–∞–Ω–µ–Ω–∏–µ**: Prometheus –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∑–∞–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –ø–æ HTTP –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
3. **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**: Grafana –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ Prometheus —á–µ—Ä–µ–∑ API –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –¥–∞—à–±–æ—Ä–¥–∞—Ö
4. **–ê–ª–µ—Ä—Ç–∏–Ω–≥**: Prometheus –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Alertmanager
5. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: Alertmanager –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞–ª–µ—Ä—Ç—ã –ø–æ email, Slack, Telegram –∏ –¥—Ä—É–≥–∏–º –∫–∞–Ω–∞–ª–∞–º

---

## üìä –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ –ø–æ—è—Å–Ω–µ–Ω–∏—è

–í —Ç–∞–±–ª–∏—Ü–µ –Ω–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –∫–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è —Å–∏—Å—Ç–µ–º–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

| –ì—Ä—É–ø–ø–∞ –º–µ—Ç—Ä–∏–∫ | –ú–µ—Ç—Ä–∏–∫–∞ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------------|---------|-----|----------|
| **üñ•Ô∏è –°–∏—Å—Ç–µ–º–Ω—ã–µ** | `node_cpu_seconds_total` | Counter | –°—É–º–º–∞—Ä–Ω–æ–µ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã CPU –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö (user, system, idle) |
| | `node_memory_MemAvailable_bytes` | Gauge | –î–æ—Å—Ç—É–ø–Ω–∞—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–º—è—Ç—å –≤ –±–∞–π—Ç–∞—Ö |
| | `node_filesystem_avail_bytes` | Gauge | –°–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –≤ –±–∞–π—Ç–∞—Ö |
| | `node_load1` | Gauge | –°—Ä–µ–¥–Ω—è—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º—ã –∑–∞ 1 –º–∏–Ω—É—Ç—É |
| | `node_network_receive_bytes_total` | Counter | –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–≤—ã—Ö –±–∞–π—Ç |
| **üì¶ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã** | `container_cpu_usage_seconds_total` | Counter | –°—É–º–º–∞—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö |
| | `container_memory_usage_bytes` | Gauge | –¢–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –≤ –±–∞–π—Ç–∞—Ö |
| | `container_network_receive_bytes_total` | Counter | –í—Ö–æ–¥—è—â–∏–π —Å–µ—Ç–µ–≤–æ–π —Ç—Ä–∞—Ñ–∏–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ |
| | `container_fs_usage_bytes` | Gauge | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ |
| **üåê –í–µ–±-—Å–µ—Ä–≤–∏—Å—ã** | `http_requests_total` | Counter | –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ |
| | `http_request_duration_seconds` | Histogram | –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ (—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ) |
| | `up` | Gauge | –°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞ (1 = –¥–æ—Å—Ç—É–ø–µ–Ω, 0 = –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω) |
| | `process_resident_memory_bytes` | Gauge | –ü–∞–º—è—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –ø—Ä–æ—Ü–µ—Å—Å–æ–º |
| **üóÑÔ∏è –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** | `pg_database_size_bytes` | Gauge | –†–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL –≤ –±–∞–π—Ç–∞—Ö |
| | `pg_stat_activity_count` | Gauge | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î |
| | `pg_postmaster_uptime_seconds` | Gauge | –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞ PostgreSQL |

> **–ü–æ—è—Å–Ω–µ–Ω–∏—è –ø–æ —Ç–∏–ø–∞–º –º–µ—Ç—Ä–∏–∫:**
> - **Gauge** - —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å—Å—è –∏ —É–º–µ–Ω—å—à–∞—Ç—å—Å—è (–ø–∞–º—è—Ç—å, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –∑–∞–≥—Ä—É–∑–∫–∞)
> - **Counter** - –º–æ–Ω–æ—Ç–æ–Ω–Ω–æ –≤–æ–∑—Ä–∞—Å—Ç–∞—é—â–∏–π —Å—á–µ—Ç—á–∏–∫ (–∑–∞–ø—Ä–æ—Å—ã, –æ—à–∏–±–∫–∏, —Ç—Ä–∞—Ñ–∏–∫)
> - **Histogram** - –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –∏ –∫–≤–∞–Ω—Ç–∏–ª–µ–π (–≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞, —Ä–∞–∑–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤)

---

## ‚öôÔ∏è –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ Prometheus

```yaml
# prometheus.yml

global:
  scrape_interval: 15s      # –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫
  evaluation_interval: 15s  # –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—Ü–µ–Ω–∫–∏ –ø—Ä–∞–≤–∏–ª –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞
  external_labels:
    environment: 'production'
    cluster: 'main'

# –ü—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞ (–≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã)
rule_files:
  - "/etc/prometheus/alerts/*.yml"

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alertmanager
alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093
      scheme: http
      timeout: 10s

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫
scrape_configs:
  # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∞–º–æ–≥–æ Prometheus
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
    scrape_interval: 30s
    metrics_path: '/metrics'
    honor_labels: true

  # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Node Exporter
  - job_name: 'node'
    static_configs:
      - targets: ['node-exporter:9100']
    scrape_interval: 15s
    labels:
      environment: 'production'
      job: 'node-exporter'
      group: 'infrastructure'

  # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ cAdvisor
  - job_name: 'cadvisor'
    static_configs:
      - targets: ['cadvisor:8080']
    scrape_interval: 15s
    labels:
      environment: 'production'
      job: 'cadvisor'
      group: 'containers'

  # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  - job_name: 'web-app'
    static_configs:
      - targets: ['web-app:8080']
    scrape_interval: 10s
    metrics_path: '/metrics'
    labels:
      environment: 'production'
      job: 'application'
      group: 'services'
# alerts/system.yml
<span style="color: red;">–ö—Ä–∞—Å–Ω—ã–π —Ç–µ–∫—Å—Ç</span>
<span style="color: #4CAF50;">–ó–µ–ª–µ–Ω—ã–π —Ç–µ–∫—Å—Ç</span>
<span style="color: blue;">–°–∏–Ω–∏–π —Ç–µ–∫—Å—Ç</span>
<span style="color: #FF9800;">–û—Ä–∞–Ω–∂–µ–≤—ã–π —Ç–µ–∫—Å—Ç</span>
